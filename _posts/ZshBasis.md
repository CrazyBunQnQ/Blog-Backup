---
title: zsh 基础
date: 2017-12-01 22:22:22
categories: Shell
tags:
- bash
- zsh
---

最近工作中需要用到 shell 脚本，正好学习 zsh 在我的学习清单里，反正早晚都要学，正好现在用到了，就边学边做了。

我将会在这篇博客中整理记录我目前使用到的 shell 脚本知识，应该都是基础知识，哈哈。

>Linux 自带的 shell 是 bash，我这学习的是 zsh（bash 能做的它都能做~），但是基础部分应该都是差不多的。
>网上关于 zsh 的文章大部分都是介绍如何安装和配置 zsh，所以这里就不介绍 zsh 的安装、使用和配置了。
>另外至于为什么使用 zsh 也不做过多解释，因为喜欢:)

<!--more-->

## 变量

接触一门新的编程语言，运行完 Hello World 后，首先要了解的基本就是如何定义和使用变量了。有了变量后可以比较变量内容，进而可以解除条件、循环、分支等语句，继而了解函数的用法...

所以，先来介绍变量和语句。

### 变量定义

zsh 的变量多数情况不需要提前声明或者指定类型，可以直接赋值和使用（哈希表例外）。

>**zsh 有 5 中变量：整数、浮点数（bash 不支持）、字符串、数组、哈希表（或者叫关联数组或字典）**，另外还有一些其他语言少有的东西，比如 alias（主要是交互的时候使用，编程基本用不到）。

#### 整数与浮点数

```bash
num1=123
num2=123.456
```

>等号两端不能有空格

#### 字符串

```bash
str1=abcde
str2='abc def'
```

>如果字符串中包含空格等特殊字符，需要加引号

```bash
str3="abc def $num1"
```

>也可以用双引号，但和单引号有区别，比如**双引号里可以使用变量**
>使用 `$变量` 来使用之前定义的 `变量`

```bash
str4="abc\tdef\ng"
```

>在字符串中可以使用转义字符，单双引号均可

#### 输入参数

输入参数是用户在使用 shell 脚本的时候输入的变量，例如 `test.sh` 中的代码如下：

```bash
in1=$1
in2=$2
in3=$3

echo "用户输入的内容是：$1 $2 $3"
```

执行 test.sh 脚本时在终端中输入下面这行代码：

```bash
sh test.sh 欢迎阅读 CrazyBunQnQ 的博客
```

该代码将会输出

```ini
echo "用户输入的内容是：欢迎阅读 CrazyBunQnQ 的博客"
```

-  `sh` 是调用 shell 脚本的命令
-  `test.sh` 是需要执行的 shell 脚本文件名，shell 文件类似 Windows 中的 `.bat` 批处理文件
- 再之后的 `test.sh` 对应的参数，每个参数之间用空格隔开

<br/>
### 变量操作

#### 输出变量

```bash
echo $str1
```

>也可以使用 print，上面这行会输出变量 str1 的值 `abcde`
>打桩法调试的时候很常用

```bash
echo $str3 > log.log
echo $str4 >> log.log
```

>`echo A > B` 会将 A 的内容写入 B 文件中
>`echo A >> B` 也会将 A 的内容写入到 B 文件中<br/>
>需要注意的是 `>>` 与 `>` 不同：
>`>` 是重新写入文件
>`>>` 是在文件中追加内容
>
>如果 B 不存在，则会创建 B 文件
>常用于输出日志

#### 简单的数值计算

```bash
num3=$(($num1 + $num2))
num3=$((num1 + num2))
```

> `((` 中的变量可以不使用 `$`

#### 截取字符串的几种方法

定义字符串如下：

```bash
str=abcdef
```

1. zsh 数组截取

    ```bash
    echo "$str[2,4]"
    # 这里会输出「bcd」，2 和 4 都是字符在数组的位置，从 1 开始数，逗号两边不能有空格
    echo "$str[4,-1]"
    # 这里输出「def」，-1 是最后一个字符
    ```

1. bash 数组截取

    ```bash
    echo "${str:0:3}"
    # 这里输出「abc」，从左边第 1 个字符开始，截取 3 个字符
    # 注意这里左边第一个字符从 0 开始，上面是从 1 开始
    echo "${str:3}"
    # 这里输出「def」，从左边第 4 个字符开始，一直到结束，也是从 0 开始计数
    echo "${str:0-4:3}"
    # 这里输出「cde」，从右数第 4 个字符开始，截取 3 个字符，不能使用「-4」，必须要有 0
    echo "${str:0-3}"
    # 这里输出「def」，从右数第 3 个字符开始，截取到结束
    ```

1. \# 号截取 —— 删除左边字符，保留右边字符 （可用于 bash)

    ```bash
    var=http://crazybunqnq.com/react-tetris
    echo ${var#*//}
    # 这里输出「crazybunqnq.com/react-tetris」
    # 其中「var」是变量名，「#」号是运算符，「*//」表示从左边开始删除第一个「//」字符串及左边的所有字符

    echo ${var##*/}
    # 这里输出「react-tetris」
    # 其中「##」是运算符，「/*」表示从右边开始删除第一个（即左数最后一个）「/」字符串及左边的所有字符
    ```

1. % 号截取 —— 删除右边字符，保留左边字符（可用于 bash）

    与 \# 号截取类似

    ```bash
    var=http://crazybunqnq.com/react-tetris
    echo ${var%/r*}
    # 这里输出「http://crazybunqnq.com」
    # 其中「%」是运算符，「/r*」表示从左边开始删除第一个「/r」字符串及右边的所有字符

    echo ${var%%/*}
    # 这里输出「http://crazybunqnq.com」
    # 其中「%%」是运算符，「/*」表示从右边开始删除第一个 (即左数最后一个)「/」字符串及游遍所有字符
    ```

>\# 表示注释，我好像在说废话...一看颜色就知道了，哈哈哈哈哈

<br/>
### 变量比较

#### 比较数值

1.  `(( ))` 用于数值比较等操作，如果为真返回 0，否则返回 1
1.  `&&` 后边的语句在前面的语句为真时才会执行
1. 必须使用双等号 `==` 来比较

    ```bash
    num=123
    ((num == 123)) && echo good
    # 这里会输出「good」
    ```

1.  `((` 里面可以使用与 `&&` 或 `||` 非 `!` 操作符

    ```bash
    ((num == 1 || num == 2)) && echo good
    # 这里会输出「good」
    ```

#### 比较字符串

1. 比较字符串要用 `[[ ]]` ，**内侧要有空格**
1. 这里的双等号 `==` 可以替换成单等号 `=`
1. $str 两侧不需要加双引号，即使 str 未定义或者 $str 中含有空格和特殊符号

    ```bash
    str=abc
    [[ $str == abc ]] && good
    # 这里会输出「good」
    ```

1. 可以和空字符串 `""` 比较，未定义的字符串和空字符串比较结果为真
1.  `[[` 里也可以使用 `&&` 、 `||` 和 `!`

    ```bash
    [[ $str == "" || $str == 123 ]] && echo good
    # 这里会输出「good」
    ```

<br/>

## 语句

简单的变量使用介绍完了，来说说语句部分。

### 条件语句

#### `[[ ]]` 用于比较字符串、判断文件等

格式：

```bash
if [[ ]] {
} elif {
} else {
}
```

>注意 `elif` 不可写作 `else if`
>尽量不要使用 `[[ ]]` 比较数值，因为不留神的话，数值会被转化成字符串来比较，没有任何错误提示

例子：

```bash
if [[ "$str" == "name" || "$str" == "value" ]] {
    echo "$str"
}
```

#### `(( ))` 用于比较数值，里面可以调用各种数值相关的函数，变量前的 `$` 可省略。

格式：

```bash
if (( )) {
}
```

例子：

```bash
if ((num > 3 && num + 3 < 10)) {
    echo $num
}
```

#### `{ }` 用于在**当前 sehll 里**运行 `{ }` 中的命令并判断运行结果

格式：

```bash
if { } {
}
```

例子：

```bash
if {echo '执行命令'} {
    echo '执行成功'
}
```

#### `( )` 用于在**子 shell 里**运行 `( )` 中的命令并判断运行结果

格式：

```bash
if ( ) {
}
```

用法和 `{ }` 类似。

#### 混合条件

以上几种括号可以一起使用，这样可以同时判断字符串、数值、文件、命令结果等。

但是建议不要混合使用 `&&` 和 `||`，会导致可读性变差且容易出错。

格式：

```bash
if [[ ]] && (( )) && { } {
}
```

<br/>

### 循环语句

>稍后补充